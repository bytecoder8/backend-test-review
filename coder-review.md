# Код ревью

Как я понимаю, зависимости пробрасываются фреймворком.

## На низком уровне:
В файле `CartManager.php` неправильный вызов конструктора `Cart`. 
Нет передачи `Customer` и способа оплаты и аргументы перепутаны местами.
Первая проблема решается использованием полноценной IDE или именованными аргументами PHP.

В `ProductRepository.php` в методе `getByCategory` анонимная функция создана как статическая,
но при этом внутри происходит вызов метода объекта из текущего контекста, скорей всего такой код вызовет ошибку в рантайме.

В этом же файле можно увидеть метод `getByUuid` без пометки, что он выбрасывает исключения Doctrine и в случае если объект не найден в бд.
Эти исключения либо должны обрабатываться фреймворком глобально, чтобы выбрасывать 500 ответ, 
либо 404 для отсутствующей сущности из репозитория когда это именно ошибка пользовательского ввода, а если этого нет, то в ближайшем Error Boundary с логированием.

Данные для запроса не экранируются, неправильное использование `fetchOne`.
Такое встречается и в других методах.


## Контроллеры:
В `AddToCartController` метод почему-то называется `get`, хотя идет добавление в корзину, логично было бы назвать `add`.
Если это RESTful приложение, то скорей всего оно будет соответствовать методу POST/PATCH в роутинге.

В `AddToCartController` в коде добавления элемента в корзину скорей всего не происходит сохранения.
Это нужно делать вручную в репозитории, либо этим должен заниматься библиотека из инфраструктуры,
которая будет синхронизировать код доменной сущности с хранилищем данных(как это делает Doctrine например).
Но я не вижу аннотаций, и корзина хранится в Redis, поэтому предполагаю что про это забыли.
И тогда возникает вопрос о переносе кода с корзиной в другой слой, например сервисный.


## Доменный слой
В `Cart.php` возможны дубликаты `CartItem` с различным количеством.
Возможно стоит хранить покупки(`CartItem`) используя uuid в качестве индекса.
Хоть в коде не отображено, но может быть ситуация когда цена на товар изменилась, 
возможно стоит давать другой ответ или пересчитывать цену в корзине.
